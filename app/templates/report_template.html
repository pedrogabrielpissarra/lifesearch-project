<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exoplanet Report: {{ planet_data.pl_name | default('Unknown Planet') }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f8f9fa; }
        h1 { color: #333; }
        h2 { color: #555; margin-top: 20px; }
        .section { margin-bottom: 20px; }
        table { margin-bottom: 20px; }
        th, td { text-align: left; vertical-align: middle; }
        .score-value { display: inline-block; width: 100px; text-align: right; margin-right: 15px; white-space: nowrap; }
        .progress-custom { width: 200px; height: 20px; display: inline-block; background-color: #e9ecef; border-radius: 4px; overflow: hidden; }
        .progress-bar-custom { height: 100%; transition: width 0.5s ease-in-out; }
        footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; font-size: 0.9em; color: #666; text-align: center; }
        footer a { color: #0066cc; text-decoration: none; }
        footer a:hover { text-decoration: underline; }
        img.scatter-plot { display: block; margin: 20px auto; max-width: 100%; text-align: center; border: 1px solid #ddd; padding: 5px; }
        .missing-plot { color: #dc3545; font-style: italic; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Exoplanet Report: {{ planet_data.pl_name | default('Unknown Planet') }}</h1>

        <div class="section">
            <h2>Planet Information</h2>
            <table class="table table-striped">
                <thead>
                    <tr><th scope="col">Field</th><th scope="col">Value</th></tr>
                </thead>
                <tbody>
                    <tr><td>Radius (Earth Radii)</td><td>{{ planet_data.pl_rade | default('N/A') }}</td></tr>
                    <tr><td>Mass (Earth Masses)</td><td>{{ planet_data.pl_masse | default('N/A') }}</td></tr>
                    <tr><td>Density (g/cm&sup3;)</td><td>{{ planet_data.pl_dens | default('N/A') }}</td></tr>
                    <tr><td>Surface Gravity (Earth g)</td><td>{{ planet_data.pl_eqt | default('N/A') }}</td></tr> <!-- Assuming pl_eqt might be surface gravity, or pl_grav if available -->
                    <tr><td>Equilibrium Temperature (K)</td><td>{{ planet_data.pl_eqt | default('N/A') }}</td></tr>
                    <tr><td>Classification</td><td>{{ classification_display | default('N/A') }}</td></tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Orbit Information</h2>
            <table class="table table-striped">
                <thead>
                    <tr><th scope="col">Field</th><th scope="col">Value</th></tr>
                </thead>
                <tbody>
                    <tr><td>Semi-Major Axis (AU)</td><td>{{ orbit_info.semi_major_axis_au | default('N/A') }}</td></tr>
                    <tr><td>Orbital Period (days)</td><td>{{ orbit_info.period_days | default('N/A') }}</td></tr>
                    <tr><td>Eccentricity</td><td>{{ orbit_info.eccentricity | default('N/A') }}</td></tr>
                    <tr><td>Inclination (deg)</td><td>{{ orbit_info.inclination_deg | default('N/A') }}</td></tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Star Information</h2>
            <table class="table table-striped">
                <thead>
                    <tr><th scope="col">Field</th><th scope="col">Value</th></tr>
                </thead>
                <tbody>
                    <tr><td>Star Name</td><td>{{ star_info.name | default('N/A') }}</td></tr>
                    <tr><td>Type</td><td>{{ star_info.type | default('N/A') }}</td></tr>
                    <tr><td>Temperature (K)</td><td>{{ star_info.temperature_k | default('N/A') }}</td></tr>
                    <tr><td>Radius (Solar Radii)</td><td>{{ star_info.radius_solar | default('N/A') }}</td></tr>
                    <tr><td>Mass (Solar Masses)</td><td>{{ star_info.mass_solar | default('N/A') }}</td></tr>
                    <tr><td>Luminosity (log(Solar))</td><td>{{ star_info.luminosity_log_solar | default('N/A') }}</td></tr>
                    <tr><td>Age (Gyr)</td><td>{{ star_info.age_gyr | default('N/A') }}</td></tr>
                    <tr><td>Metallicity (dex)</td><td>{{ star_info.metallicity_dex | default('N/A') }}</td></tr>
                    <tr><td>Distance (ly)</td><td>{{ star_info.distance_ly | default('N/A') }}</td></tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Travel Curiosities (to {{ planet_data.pl_name | default('Planet') }})</h2>
            <table class="table table-striped">
                <thead>
                    <tr><th scope="col">Scenario</th><th scope="col">Estimated Travel Time</th></tr>
                </thead>
                <tbody>
                    <tr><td>{{ travel_curiosities.scenario_1_label | default('Scenario 1') }}</td><td>{{ travel_curiosities.scenario_1_time | default('N/A') }}</td></tr>
                    <tr><td>{{ travel_curiosities.scenario_2_label | default('Scenario 2') }}</td><td>{{ travel_curiosities.scenario_2_time | default('N/A') }}</td></tr>
                    <tr><td>{{ travel_curiosities.scenario_3_label | default('Scenario 3') }}</td><td>{{ travel_curiosities.scenario_3_time | default('N/A') }}</td></tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>Habitability Scores</h2>
            <table class="table table-striped">
                <thead>
                    <tr><th scope="col">Field</th><th scope="col">Value</th></tr>
                </thead>
                <tbody>
                    {% for score in scores %}
                        <tr>
                            <td>{{ score.field }}</td>
                            <td>
                                {% if score.value is not none and score.value != 'N/A' %}
                                    <span class="score-value">{{ "%.2f"|format(score.value|float) }}%</span>
                                    <div class="progress-custom">
                                        <div class="progress-bar-custom" style="width: {{ score.value }}%; background-color: {{ score.color }};"></div>
                                    </div>
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                        </tr>
                    {% else %}
                        <tr><td colspan="2">No scores available.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>SEPHI Scores</h2>
            <table class="table table-striped">
                <thead>
                    <tr><th scope="col">Field</th><th scope="col">Value</th></tr>
                </thead>
                <tbody>
                    {% for sephi in sephi_scores %}
                        <tr>
                            <td>{{ sephi.field }}</td>
                            <td>
                                {% if sephi.value is not none and sephi.value != 'N/A' %}
                                    <span class="score-value">{{ "%.2f"|format(sephi.value|float) }}%</span>
                                    <div class="progress-custom">
                                        <div class="progress-bar-custom" style="width: {{ sephi.value }}%; background-color: {{ sephi.color }};"></div>
                                    </div>
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                        </tr>
                    {% else %}
                        <tr><td colspan="2">No SEPHI scores available.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="section text-center">
            <h2>Visualizations</h2>
            {% if plots.scores_plot %}
                <div>
                    <h3>Scores Chart</h3>
                    <img src="{{ plots.scores_plot }}" class="img-fluid scatter-plot" alt="Scores Chart">
                </div>
            {% else %}
                <p class="missing-plot">Scores chart not available.</p>
            {% endif %}
            
            {% if plots.hz_plot %}
                <div class="mt-4">
                    <h3>Habitable Zone Chart</h3>
                    <img src="{{ plots.hz_plot }}" class="img-fluid scatter-plot" alt="Habitable Zone Chart">
                </div>
            {% else %}
                <p class="missing-plot">Habitable zone chart not available.</p>
            {% endif %}
        </div>

        <footer>
            <p>Data obtained from:</p>
            <p>
                <a href="https://exoplanetarchive.ipac.caltech.edu/index.html" target="_blank">NASA Exoplanet Archive</a> |
                <a href="https://phl.upr.edu/hwc/data" target="_blank">PHL Habitable Worlds Catalog</a> |
                <a href="http://www.hzgallery.org/table.html" target="_blank">HZGallery</a>|
                <a href="https://academic.oup.com/mnras/article/471/4/4628/4096396" target="_blank">MNRAS HZ Exoplanet Catalog</a>  |
                <a href="http://exoplanetes.esep.pro/index.php/home-fr/table-des-exoplanetes-fr" target="_blank">ESEP Exoplanet Table</a>
            </p>
            <p><small>Report generated on {{ datetime.now().strftime("%Y-%m-%d %H:%M:%S") }} UTC</small></p>
        </footer>
    </div>
</body>
</html>
